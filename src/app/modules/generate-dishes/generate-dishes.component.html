<div class="flex flex-col flex-auto min-w-0">

    <!-- Header -->
    <div class="dark bg-card dark:border-b">
        <div class="flex flex-col w-full max-w-screen-xl mx-auto px-6 sm:px-8">
            <div class="flex flex-col sm:flex-row flex-auto sm:items-center min-w-0 my-8 sm:my-12">
                <!-- Avatar and name -->
                <div class="flex flex-auto items-center min-w-0">
                    <div class="flex-0 w-16 h-16 rounded-full overflow-hidden">
                        <img
                            class="w-full h-full object-cover"
                            src="assets/images/avatars/brian-hughes.jpg">
                    </div>
                    <div class="flex flex-col min-w-0 ml-4">
                        <ng-container>
                            <div class="text-2xl md:text-5xl font-semibold tracking-tight leading-7 md:leading-snug truncate">Prochains Repas</div>
                        </ng-container>
                        <!--<div class="flex items-center">
                            <mat-icon
                                class="icon-size-5"
                                [svgIcon]="'heroicons_solid:bell'"></mat-icon>
                            <div class="ml-1.5 leading-6 truncate text-secondary">You have 2 new messages and 15 new tasks</div>
                        </div>-->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main -->
    <div class="flex-auto m-0 sm:m-6">
        <div class="w-full max-w-none md:max-w-3xl mx-auto">
            <div class="sm:col-span-2 md:col-span-4 lg:col-span-2 flex flex-col flex-auto bg-card shadow rounded-none sm:rounded-2xl overflow-hidden">
                <mat-vertical-stepper class="mat-elevation-z4 rounded" [linear]="true" #stepper>
                    <mat-step [stepControl]="verticalStepperStep1">
                        <form fxLayout="column" [formGroup]="verticalStepperStep1">
                            <ng-template matStepLabel>Renseigner le nombre de jours</ng-template>
        
                            <div fxFlex="1 0 auto" fxLayout="column">
        
                                <mat-form-field appearance="fill" fxFlex="100">
                                    <mat-label>Nombre de jours : </mat-label>
                                    <input matInput type="number" formControlName="nbJours" required>
                                    <span matSuffix><mat-icon>calendar_today</mat-icon></span>
                                    <mat-error>Le nombre de jours est requis !</mat-error>
                                </mat-form-field>
         
                            </div>
        
                            <div fxLayout="row" fxLayoutAlign="center center">
                                <button mat-raised-button (click)="genererCalendrier(stepper)" type="button" color="primary">
                                    Suivant
                                </button>
                            </div>
        
                        </form>
        
                    </mat-step>
        
                    <mat-step>
        
                        <ng-template matStepLabel (click)="genererCalendrier(stepper)">Renseigner les jours ou il faut générer des repas</ng-template>
                            <mat-table [dataSource]="choixDates" class="mat-elevation-z8 tableauJours shadow-none bg-transparent mb-4"> <!--#table>-->
         
                                <!-- Date -->
                                <ng-container matColumnDef="date">
                                  <mat-header-cell *matHeaderCellDef class="min-width"> Date </mat-header-cell>
                                  <mat-cell *matCellDef="let element" class="min-width"> {{element.date | date:'EEEE, d MMMM' | titlecase}} </mat-cell>
                                </ng-container>
                              
                                <!-- Midi -->
                                <ng-container matColumnDef="midi">
                                    <mat-header-cell *matHeaderCellDef class="justify-center">Midi</mat-header-cell>
                                    <mat-cell *matCellDef="let element" class="justify-center">
                                        <mat-checkbox class="m-0" (change)="modifRepas(element, $event.checked, 'midi')" [checked]="element.midi"></mat-checkbox>                           
                                    </mat-cell>
                                </ng-container>
        
                                <!-- Soir -->
                                <ng-container matColumnDef="soir">
                                    <mat-header-cell *matHeaderCellDef class="justify-center">Soir</mat-header-cell>
                                    <mat-cell *matCellDef="let element" class="justify-center">
                                        <mat-checkbox (change)="modifRepas(element, $event.checked, 'soir')" [checked]="element.soir"></mat-checkbox>                           
                                    </mat-cell>
                                </ng-container>
                              
                                <mat-header-row *matHeaderRowDef="displayedColumns"></mat-header-row>
                                <mat-row [ngClass]="{'gray-bg': row.weekendFerie }" *matRowDef="let row; columns: displayedColumns;"></mat-row>
                            </mat-table>
        
                            <div fxLayout="row" fxLayoutAlign="center center">
                                <button class="mr-8" mat-raised-button matStepperPrevious type="button" color="accent">
                                    Précedent
                                </button>
                                <button mat-raised-button (click)="genererRepas(stepper)" type="button" color="primary">
                                    Suivant
                                </button>
                            </div>
                    </mat-step>
        
                    <mat-step>
                        <ng-template matStepLabel>Renseignez les repas</ng-template>
                        
                        <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 shadow-none bg-transparent w-full mb-4">
        
                            <!-- Date -->
                            <ng-container matColumnDef="moment">
                                <th mat-header-cell *matHeaderCellDef>Date</th>
                                <td mat-cell *matCellDef="let element" class="w-1/4">
                                    <div class="flex items-center py-1 px-2 rounded-full text-sm font-medium text-white bg-accent-700 dark:text-white dark:bg-gray-700">
                                        {{element.moment}}
                                    </div>
                                </td>
                            </ng-container>
                            
                            <!-- repas Column -->
                            <ng-container matColumnDef="repas" cdkDropListGroup>
                                <th mat-header-cell *matHeaderCellDef>Repas</th>
                                <td mat-cell *matCellDef="let element" class="w-3/4">
                                    <mat-chip-list #chipList cdkDropList class="dragDrop" [cdkDropListData]="element.repas" (cdkDropListDropped)="drop($event, element)">
                                            <mat-chip *ngFor="let item of element.repas" class="gray-bg change-mouse" cdkDrag (removed)="remove(item, element.repas)">
                                                {{item}}
                                                <mat-icon matChipRemove>cancel</mat-icon>
                                            </mat-chip>
                                            <mat-chip class="primary" *ngIf="element.repas == null || element.repas.length === 0">+</mat-chip>
                                            <input *ngIf="element.repas == null || element.repas.length === 0" placeholder="Nouveau Repas..."
                                                #repasInput
                                                [formControl]="repasCtrl"
                                                [matAutocomplete]="auto"
                                                [matChipInputFor]="chipList"
                                                [matChipInputSeparatorKeyCodes]="separatorKeysCodes"
                                                [matChipInputAddOnBlur]="addOnBlur"
                                                    (matChipInputTokenEnd)="add($event, element.repas)">
                                    </mat-chip-list>
                                    <mat-autocomplete #auto="matAutocomplete" (optionSelected)="selected($event, element.repas)" panelWidth="auto">
                                        <mat-option *ngFor="let repas of filteredRepas | async" [value]="repas">
                                            {{repas}}
                                        </mat-option>
                                    </mat-autocomplete>
                                </td>
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="columnsChoixRepas"></tr>
	                        <tr mat-row *matRowDef="let row; columns: columnsChoixRepas;"></tr>

                             <ng-container matColumnDef="date">
                                <td mat-cell *matCellDef="let element" colspan="2" class="gray-bg font-medium"> 
                                    {{element.date | date:'EEEE, d MMMM YYYY' | titlecase }} 
                                </td>
                            </ng-container>
                            <tr mat-row *matRowDef="let row; columns: ['date']; when: isGroup"> </tr>
                        </table>
        
                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button class="mr-8" mat-raised-button matStepperPrevious type="button" color="accent">
                                Précedent
                            </button>
                            <button mat-raised-button matStepperNext type="button" color="primary">
                                Suivant
                            </button>
                        </div>
        
                    </mat-step>
        
                    <mat-step>
        
                        <ng-template matStepLabel>Renseignez le nombre de personnes</ng-template>
        
                        <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 shadow-none bg-transparent w-full mb-4">
        
                            <!-- Date -->
                            <ng-container matColumnDef="moment">
                                <th mat-header-cell *matHeaderCellDef>Date</th>
                                <td mat-cell *matCellDef="let element" class="w-1/4">
                                    <div class="flex items-center py-1 px-2 rounded-full text-sm font-medium text-white bg-accent-700 dark:text-white dark:bg-gray-700">
                                        {{element.moment}}
                                    </div>
                                </td>
                            </ng-container>
                            
                            <ng-container matColumnDef="repas">
                                <th mat-header-cell *matHeaderCellDef>Repas</th>
                                <td mat-cell *matCellDef="let element" class="w-2/4"> {{element.repas}} </td>
                            </ng-container>

                            <ng-container matColumnDef="nbPersonnes">
                                <th mat-header-cell *matHeaderCellDef>Nombre de Personnes</th>
                                <td mat-cell *matCellDef="let element" class="w-1/4">  
                                    <div id="people" class="flex items-center mt-1.5 px-4 leading-9 justify-center rounded-full cursor-pointer text-gray-800 bg-gray-200 dark:text-gray-100 dark:bg-gray-500"
                                        [matMenuTriggerFor]="priorityMenu">
                                        <ng-container >
                                            <span class="text-md font-medium mr-1">{{element.nbPersonnes}}</span>
                                            <mat-icon svgIcon="people_alt" class="icon-size-5 mr-1"></mat-icon>
                                            <mat-icon
                            class="icon-size-4 text-current"
                            [svgIcon]="'heroicons_outline:chevron-down'"></mat-icon>
                                        </ng-container>
                                    </div>
                                    <mat-menu #priorityMenu="matMenu">
                                    <!-- Normal -->
                                    <button *ngFor="let nbPeople of [1,2,3,4,5,6,7,8,9]" value="{{nbPeople}}"
                                        mat-menu-item
                                        (click)="modifyNumberOfPeople(nbPeople, element.id)">
                                        <span class="inline-flex items-center justify-between w-full min-w-30 leading-5">
                                            <span class="font-medium">{{nbPeople}} {{nbPeople == 1 ? 'Personne' : 'Personnes'}}</span>
                                        </span>
                                    </button>
                                </mat-menu>
                                </td> 
                            </ng-container>

                            <tr mat-header-row *matHeaderRowDef="peopleColumns"></tr>
	                        <tr mat-row *matRowDef="let row; columns: peopleColumns;"></tr>

                             <ng-container matColumnDef="date">
                                <td mat-cell *matCellDef="let element" colspan="3" class="gray-bg font-medium"> 
                                    {{element.date | date:'EEEE, d MMMM YYYY' | titlecase }} 
                                </td>
                            </ng-container>
                            <tr mat-row *matRowDef="let row; columns: ['date']; when: isGroup"> </tr>
                        </table>

                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button class="mr-8" mat-raised-button matStepperPrevious type="button" color="accent">
                                Précedent
                            </button>
                            <button mat-raised-button type="button" color="primary" matStepperNext>
                                Suivant
                            </button>
                        </div>
                    </mat-step>
                    <mat-step [stepControl]="verticalStepperStep5">
                        <ng-template matStepLabel>Générer la liste des courses</ng-template>
                        <form fxLayout="column" [formGroup]="verticalStepperStep5">
                            <div class="flex flex-col mt-4 gt-sm:mt-0 gt-sm:ml-16 mb-4">
                                <span class="font-medium mb-2">
                                    Souhaitez vous générer la liste des courses de vos prochains repas ? 
                                </span>
                                <mat-radio-group
                                    class="flex flex-col"
                                    [color]="'primary'"
                                    [formControlName]="'generateShoppingList'">
                                    <mat-radio-button
                                        class="mb-2"
                                        [value]="'oui'">
                                        Oui
                                    </mat-radio-button>
                                    <mat-radio-button
                                        class="mb-2"
                                        [value]="'non'">
                                        Non
                                    </mat-radio-button>
                                </mat-radio-group>
                            </div>
                        </form>
                        <div fxLayout="row" fxLayoutAlign="center center">
                            <button class="mr-8" mat-raised-button matStepperPrevious type="button" color="accent">
                                Précedent
                            </button>
                            <button mat-raised-button type="button" color="primary" (click)="generateDishes()">
                                Confirmer
                            </button>
                        </div>
                    </mat-step>
                </mat-vertical-stepper>
            </div>
        </div>
    </div>
</div>